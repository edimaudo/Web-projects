population script # built on the core directory

import os
import django
import pandas as pd
import csv

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'olympics.settings')
django.setup()
from goldmetrics.models import Medal, Country

def populate():
    countries = pd.read_csv("country.csv")
    medals = pd.read_csv("goldmedal.csv")
    for i, country in countries.iterrows():
        add_country(country['Country'], country['Code'], country['Population'], country['GDP'])
    
    
    for j, medal in medals.iterrows():
        add_medal(medal['Year'],medal['City'],medal['Sport'],medal['Discipline'],medal['Athlete'],medal['Country'],medal['Gender'],medal['Event'],medal['Medal'])

def add_country(country, code, population, gdp):
    print(country, code, population, gdp)
    country_info = Country.objects.get_or_create(Country=country, Code=code, Population=population, GDP=gdp)[0]
    country_info.save()
    return country_info

def add_medal(year, city, sport, discipline, athlete, country, gender, event, medal):
    print(year, city, sport, discipline, athlete, country, gender, event, medal)
    medal_info = Medal.objects.get_or_create(Year = year, City=city, Sport = sport, Discipline=discipline, Athlete=athlete, Country=country, Gender=gender, Event=event, Medal=medal)[0]
    medal_info.save()
    return medal_info

if __name__ == '__main__':
    print("Starting Gold Metrics population script...")
    populate()
    print("Populating Gold Metrics population script completed")